---
title: Makeover Monday (Evictions in San Francisco)
author: Philippe Massicotte
date: '2019-09-22'
slug: makeover-monday-evictions-in-san-francisco
categories: []
tags:
  - Makeover Monday
  - Visualization
  - Tidyverse
type: ''
subtitle: ''
image: ''
---



<pre class="r"><code>df &lt;- read_csv(&quot;https://query.data.world/s/wcntg2ynqmimnjd7tl4d4ybjwf2nv6&quot;) %&gt;%
  janitor::clean_names()

df &lt;- df %&gt;%
  mutate(file_date = lubridate::mdy(file_date)) %&gt;%
  mutate(year = lubridate::year(file_date)) %&gt;%
  extract(location, into = c(&quot;longitude&quot;, &quot;latitude&quot;), regex = &quot;POINT \\((-?\\d+\\.\\d+) (\\d+\\.\\d+)\\)&quot;, convert = TRUE) %&gt;%
  pivot_longer(c(non_payment:good_samaritan_ends), names_to = &quot;reason&quot;, values_to = &quot;value&quot;) %&gt;%
  filter(value) %&gt;%
  drop_na(longitude, latitude, year)

# df %&gt;%
#   group_by(eviction_id) %&gt;%
#   # filter(value) %&gt;%
#   ungroup() %&gt;%
#   count(eviction_id, sort = T)
#
df %&gt;%
  count(neighborhoods_analysis_boundaries, sort = TRUE)
#&gt; # A tibble: 42 x 2
#&gt;    neighborhoods_analysis_boundaries     n
#&gt;    &lt;chr&gt;                             &lt;int&gt;
#&gt;  1 Mission                            4620
#&gt;  2 Tenderloin                         2725
#&gt;  3 Sunset/Parkside                    2664
#&gt;  4 Outer Richmond                     2144
#&gt;  5 Castro/Upper Market                1866
#&gt;  6 Lakeshore                          1785
#&gt;  7 Hayes Valley                       1550
#&gt;  8 South of Market                    1486
#&gt;  9 Nob Hill                           1458
#&gt; 10 Haight Ashbury                     1340
#&gt; # ... with 32 more rows

caption &lt;- df %&gt;% 
   count(reason, sort = TRUE) %&gt;% 
   top_n(10) %&gt;% 
   mutate(reason = str_replace_all(reason, &quot;_&quot;, &quot; &quot;)) %&gt;% 
   mutate(reason = str_to_title(reason)) %&gt;% 
   mutate(txt = glue(&quot;{reason} (n = {n})&quot;)) %&gt;% 
   pull(txt)

caption &lt;- str_c(&quot;Number of eviction between 1997 and 2019: &quot;, str_c(caption, collapse = &quot;, &quot;))

sf &lt;- st_read(&quot;c:/Users/pmass.000/Downloads/SF Find Neighborhoods/geo_export_8a1285c6-4a44-4018-b2b8-8fb53561f318.shp&quot;) %&gt;%
  mutate(name = as.character(name))
#&gt; Reading layer `geo_export_8a1285c6-4a44-4018-b2b8-8fb53561f318&#39; from data source `c:\Users\pmass.000\Downloads\SF Find Neighborhoods\geo_export_8a1285c6-4a44-4018-b2b8-8fb53561f318.shp&#39; using driver `ESRI Shapefile&#39;
#&gt; Simple feature collection with 117 features and 2 fields
#&gt; geometry type:  POLYGON
#&gt; dimension:      XY
#&gt; bbox:           xmin: -122.5149 ymin: 37.70809 xmax: -122.357 ymax: 37.8324
#&gt; epsg (SRID):    4326
#&gt; proj4string:    +proj=longlat +ellps=WGS84 +no_defs


df2 &lt;- df %&gt;%
  st_as_sf(coords = c(&quot;longitude&quot;, &quot;latitude&quot;), crs = 4326) %&gt;%
  st_transform(st_crs(sf)) %&gt;%
  st_join(sf, .)

df2 %&gt;%
  filter(year %in% c(1997, 2004, 2011, 2018)) %&gt;%
  group_by(name, year) %&gt;%
  summarise(sum_eviction = sum(value, na.rm = TRUE)) %&gt;%
  ungroup() %&gt;%
  ggplot() +
  geom_sf(data = sf, fill = &quot;white&quot;, size = 0.1, color = &quot;white&quot;) +
  geom_sf(aes(fill = sum_eviction), size = 0.1, color = &quot;white&quot;) +
  facet_wrap(~year, drop = TRUE, ncol = 4, strip.position = &quot;bottom&quot;) +
  coord_sf() +
  scale_fill_viridis_c(trans = &quot;log10&quot;, option = &quot;plasma&quot;) +
  labs(
    fill = &quot;Number of\nevictions&quot;,
    title = str_wrap(&quot;Total number of San Francisco eviction notices in 1997, 2004, 2011 and 2018&quot;, 60),
    subtitle = str_wrap(caption, width = 110),
    caption = &quot;Makeover Monday (2019/W39) | Data Source: DataSF | Visualization: @philmassicotte&quot;
  ) +
  theme(
    panel.grid = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    panel.border = element_blank(),
    strip.background = element_rect(fill = &quot;#2b2d2f&quot;),
    strip.text = element_text(face = 2, size = 24, color = &quot;white&quot;),
    panel.background = element_rect(fill = &quot;#2b2d2f&quot;),
    plot.caption = element_text(size = 8, color = &quot;white&quot;, hjust = 0),
    plot.subtitle = element_text(size = 10)
  )</code></pre>
<p><img src="/post/2019-09-22-makeover-monday-evictions-in-san-francisco.en_files/figure-html/unnamed-chunk-1-1.svg" width="100%" style="display: block; margin: auto;" /></p>
