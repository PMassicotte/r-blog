---
title: Analyzing the programming languages used in R packages
author: Philippe Massicotte
date: '2019-08-18'
slug: analyzing-the-programming-languages-used-in-r-packages
categories:
  - R
tags:
  - Programming languages
  - R package
type: ''
subtitle: ''
image: ''
---



<p>It is easy to integrate other programming languages withing R. For instance, <a href="http://www.rcpp.org/">Rcpp</a> and <a href="https://rstudio.github.io/reticulate/">reticulate</a> can be used to interface R with C++ and Python. In this post, I am analyzing the programming languages used in the R packages published on <a href="https://cran.r-project.org/src/contrib/">CRAN</a>. I have downloaded all published packages and used <a href="https://github.com/AlDanial/cloc">cloc</a> (v1.82) to count the number of lines of code in each package. <em>Disclaimer</em>: cloc does not only count line of code for programming language. It also counts the number of lines in a markup language such as markdown. In this post, I make no difference between language types. At the time of writing this post, approximately 14 700 packages were analyzed.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>Letâ€™s load all the packages needed for this analysis.</p>
<pre class="r"><code>library(tidyverse)
library(rvest)
library(glue)
library(curl)
library(fs)
library(furrr)
library(tidytext)
library(ggpmthemes) # devtools::install_github(&quot;pmassicotte/ggpmthemes&quot;)

theme_set(theme_exo())

# Setup the number of cores to use with furrr
plan(multiprocess(workers = availableCores() - 1))</code></pre>
</div>
<div id="download-the-cran-packages" class="section level2">
<h2>Download the CRAN packages</h2>
<p>The first step consists in downloading all the packages onto my hard drive. I am using <code>rvest</code> and <code>curl</code> for this operation.</p>
<pre class="r"><code>links &lt;- read_html(&quot;https://cran.r-project.org/src/contrib/&quot;) %&gt;%
  html_nodes(&quot;a&quot;) %&gt;%
  html_attr(&quot;href&quot;) %&gt;%
  enframe(name = NULL, value = &quot;link&quot;) %&gt;%
  filter(str_ends(link, &quot;tar.gz&quot;)) %&gt;%
  mutate(destfile = glue(&quot;g:/r-packages/{link}&quot;)) %&gt;%
  mutate(link = glue(&quot;https://cran.r-project.org/src/contrib/{link}&quot;))

# Download packages
links %&gt;%
  future_pmap(~ curl_download(url = ..1, destfile = ..2), .progress = TRUE)</code></pre>
</div>
<div id="count-lines-of-code" class="section level2">
<h2>Count lines of code</h2>
<p>To count lines of code, <a href="https://github.com/AlDanial/cloc">cloc</a> (v1.82) needs to be installed in your PATH. Once installed, you can use cloc to analyze a directory containing source code files. Furthermore, results generated by cloc can be exported into a CSV file. Here, one CSV file for each package will be generated.</p>
<pre class="r"><code>
links &lt;- links %&gt;%
  mutate(loc_csv = glue(&quot;{tools::file_path_sans_ext(destfile)}.csv&quot;))

extract_loc &lt;- function(destfile, loc_csv) {
  untar(destfile, exdir = &quot;g:/r-packages/&quot;)
  pkg_dir &lt;- untar(destfile, exdir = &quot;g:/r-packages/&quot;, list = TRUE)
  pkg_dir &lt;- glue(&quot;g:/r-packages/{pkg_dir}&quot;, pkg_dir = pkg_dir[[1]])

  system(
    glue(
      &quot;cloc-1.82.exe {pkg_dir} --out={loc_csv} --csv&quot;
    )
  )
}

# Count the number of code lines and write a CSV file.
links %&gt;%
  future_pmap(~ extract_loc(..2, ..3), .progress = TRUE)</code></pre>
<p>Then, we can read all the generated CSV files.</p>
<pre class="r"><code>csv_files &lt;- dir_ls(&quot;g:/r-packages/&quot;, regexp = &quot;\\.csv$&quot;)

pkg &lt;-
  future_map_dfr(csv_files,
    function(file) {
      data.table::fread(
        file,
        header = FALSE,
        skip = 1,
        col.names = c(&quot;file&quot;, &quot;language&quot;, &quot;blank&quot;, &quot;comment&quot;, &quot;code&quot;)
      ) %&gt;%
        mutate(pkg = !!file)
    }
  ) %&gt;%
  as_tibble() %&gt;%
  filter(language != &quot;SUM&quot;) %&gt;%
  extract(
    col = pkg,
    into = c(&quot;pkg_name&quot;, &quot;version&quot;),
    regex = &quot;G:/r-packages/(.*)_(.*).tar.csv&quot;
  )

pkg</code></pre>
</div>
<div id="languages-used-in-r-packages" class="section level2">
<h2>Languages used in R packages</h2>
<p>There are a total of 108 programming languages used in CRAN R packages. The following graph shows the top 16 most used (determined by the number of lines).</p>
<pre class="r"><code>languages &lt;- pkg %&gt;% 
  count(language, sort = TRUE, name = &quot;n_package&quot;)

languages
#&gt; # A tibble: 108 x 2
#&gt;    language     n_package
#&gt;    &lt;chr&gt;            &lt;int&gt;
#&gt;  1 R                14689
#&gt;  2 Markdown          5710
#&gt;  3 HTML              3680
#&gt;  4 C                 2162
#&gt;  5 C++               2041
#&gt;  6 C/C++ Header      1867
#&gt;  7 Bourne Shell       500
#&gt;  8 CSS                459
#&gt;  9 TeX                401
#&gt; 10 JavaScript         370
#&gt; # ... with 98 more rows

languages %&gt;% 
  top_n(16, n_package) %&gt;% 
  mutate(language = fct_reorder(language, n_package)) %&gt;% 
  ggplot(aes(x = language, y = n_package)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.2))) +
  xlab(NULL) +
  ylab(&quot;Number of package&quot;) +
  labs(title = str_wrap(&quot;Number of R packages using the top 16 most used programming languages&quot;, 40)) +
  labs(subtitle = glue(&quot;Based on {n_distinct(pkg$pkg_name)} packages&quot;)) +
  labs(caption = &quot;Data: https://cran.r-project.org/src/contrib/&quot;)</code></pre>
<p><img src="/post/2019-08-18-analyzing-the-programming-languages-used-in-r-packages.en_files/figure-html/unnamed-chunk-6-1.svg" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="count-the-number-of-loc-per-language" class="section level2">
<h2>Count the number of LOC per language</h2>
<p>What are the most used programming languages used in R packages? Obviously, R is the #1 language and there is a total of 22,822,548.0 lines of R code in published R packages. That is pretty impressive! The next graph shows the total number of lines of code found in all CRAN packages.</p>
<pre class="r"><code>most_popular &lt;- pkg %&gt;% 
  group_by(language) %&gt;% 
  summarise(total_loc = sum(code)) %&gt;% 
  filter(dense_rank(desc(total_loc)) &lt;= 16) %&gt;% 
  mutate(language = fct_reorder(language, total_loc, .fun = sum)) 

most_popular %&gt;%
  ggplot(aes(x = language, y = total_loc)) +
  geom_col() +
  coord_flip() +
  xlab(NULL) +
  ylab(&quot;Number of line of code&quot;) +
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.2)), labels = scales::comma) +
  labs(
    title = str_wrap(&quot;Top 16 programming languages used in R packages&quot;, 40),
    subtitle = glue(&quot;Based on {n_distinct(pkg$pkg_name)} packages&quot;),
    caption = &quot;Data: https://cran.r-project.org/src/contrib/&quot;
  )</code></pre>
<p><img src="/post/2019-08-18-analyzing-the-programming-languages-used-in-r-packages.en_files/figure-html/unnamed-chunk-7-1.svg" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="programming-languages-used-in-r-packages" class="section level2">
<h2>Programming languages used in R packages</h2>
<p>The following graph shows the 18 packages with the highest number of lines of code differentiated by languages.</p>
<pre class="r"><code>pkg %&gt;% 
  group_by(pkg_name) %&gt;% 
  add_tally(code) %&gt;% 
  ungroup() %&gt;% 
  filter(dense_rank(desc(n)) &lt;= 18) %&gt;% 
  mutate(language = reorder_within(language, code, pkg_name)) %&gt;% 
  mutate(pkg_name = fct_reorder(pkg_name, code, sum, .desc = TRUE)) %&gt;% 
  ggplot(aes(x = language, y = code)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~ pkg_name, scales = &quot;free&quot;, ncol = 3) +
  scale_x_reordered() +
  scale_y_log10(expand = expand_scale(mult = c(0, 0.2))) +
  xlab(NULL) +
  ylab(&quot;Number of line of code&quot;) +
  labs(title = str_wrap(&quot;Programming languages used in packages with the most number of lines of code&quot;, 40)) +
  labs(subtitle = &quot;Packages are arranged in descending order of the total number of lines of code&quot;) +
  labs(caption = &quot;Data: https://cran.r-project.org/src/contrib/&quot;)</code></pre>
<p><img src="/post/2019-08-18-analyzing-the-programming-languages-used-in-r-packages.en_files/figure-html/unnamed-chunk-8-1.svg" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="the-tidyverse" class="section level2">
<h2>The <em>tidyverse</em></h2>
<p>The following graph shows the programming languages used by the package included in the <em>tidyverse</em> ecosystem.</p>
<pre class="r"><code>pkg %&gt;%
  filter(
    pkg_name %in% c(
      &quot;ggplot2&quot;,
      &quot;dplyr&quot;,
      &quot;tidyr&quot;,
      &quot;readr&quot;,
      &quot;purrr&quot;,
      &quot;tibble&quot;,
      &quot;stringr&quot;,
      &quot;focats&quot;,
      &quot;lubridate&quot;,
      &quot;hms&quot;, 
      &quot;feather&quot;, 
      &quot;haven&quot;,
      &quot;jsonlite&quot;,
      &quot;readxl&quot;,
      &quot;rvest&quot;,
      &quot;xml2&quot;,
      &quot;modelr&quot;,
      &quot;broom&quot;
    )
  ) %&gt;%
  mutate(language = reorder_within(language, code, pkg_name)) %&gt;%
  mutate(pkg_name = fct_reorder(pkg_name, code, sum, .desc = TRUE)) %&gt;%
  ggplot(aes(x = language, y = code)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~pkg_name, scales = &quot;free&quot;, ncol = 3) +
  scale_x_reordered() +
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.2))) +
  # scale_y_continuous(labels = scales::scientific) +
  xlab(NULL) +
  ylab(&quot;Number of line of code&quot;) +
  labs(title = &quot;Programming languages used in the tidyverse&quot;) +
  labs(subtitle = &quot;Packages are arranged in descending order of the total number of lines of code&quot;) +
  labs(caption = &quot;Data: https://cran.r-project.org/src/contrib/&quot;)</code></pre>
<p><img src="/post/2019-08-18-analyzing-the-programming-languages-used-in-r-packages.en_files/figure-html/unnamed-chunk-9-1.svg" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="r-c-and-python" class="section level2">
<h2>R, C++ and Python</h2>
<p>R, C++ and Python are the three programming languages I use the most. I wanted to know what was the proportion of lines of code were used by these languages in all CRAN packages. For the exercise, I regrouped C/C++ code together. It is interesting to see that C++ represent approximately 40% of the code lines of R packages. Thanks to Rcpp!</p>
<pre class="r"><code>big_three &lt;- pkg %&gt;% 
  filter(language %in% c(&quot;R&quot;, &quot;C++&quot;, &quot;C&quot;, &quot;C/C++ Header&quot;, &quot;Python&quot;)) %&gt;% 
  mutate(language = case_when(
    language %in% c(&quot;C++&quot;, &quot;C&quot;, &quot;C/C++ Header&quot;) ~ &quot;C++&quot;,
    TRUE ~ language
  )) %&gt;% 
  group_by(language) %&gt;% 
  summarise(percent = sum(code) / sum(.$code))

big_three %&gt;%
  mutate(language = fct_reorder(language, percent)) %&gt;%
  ggplot(aes(x = language, y = percent)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = scales::percent, expand = expand_scale(mult = c(0, 0.2))) +
  xlab(NULL) +
  ylab(&quot;Percentage of line of code&quot;) +
  labs(
    title = str_wrap(&quot;Percentage of R, C++ and Python used in R packages&quot;, 40),
    subtitle = glue(&quot;Based on {n_distinct(pkg$pkg_name)} packages&quot;),
    caption = &quot;Data: https://cran.r-project.org/src/contrib/&quot;
  )</code></pre>
<p><img src="/post/2019-08-18-analyzing-the-programming-languages-used-in-r-packages.en_files/figure-html/unnamed-chunk-10-1.svg" width="100%" style="display: block; margin: auto;" /></p>
</div>
